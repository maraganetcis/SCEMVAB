<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SCEMVAB PPI - 성격검사</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#7dd3fc;--muted:#9aa9bf;--glass:rgba(255,255,255,0.04)}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;background:linear-gradient(180deg,#071022 0%, #08182a 100%);color:#e6eef8}
  .wrap{max-width:1080px;margin:18px auto;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}
  h1{margin:0 0 6px;font-weight:700}
  p.lead{margin:0 0 12px;color:var(--muted)}
  .progress-bar{background:rgba(255,255,255,0.06);height:8px;border-radius:8px;overflow:hidden;margin-bottom:16px}
  .progress-fill{background:linear-gradient(90deg,var(--accent),#60a5fa);height:100%;width:0%;transition:width 0.3s ease}
  .grid{display:grid;grid-template-columns:1fr 400px;gap:18px}
  .questions{background:var(--card);padding:16px;border-radius:10px;max-height:74vh;overflow:auto}
  .panel{background:var(--glass);padding:12px;border-radius:10px}
  .q{padding:10px 8px;border-radius:8px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.008), transparent);transition:background 0.2s}
  .q.answered{background:linear-gradient(180deg, rgba(125,211,252,0.05), rgba(125,211,252,0.02))}
  .q .txt{font-size:14px;margin-bottom:6px}
  .scale{display:flex;gap:6px}
  .scale input[type=radio]{display:none}
  .scale label{flex:1;text-align:center;padding:8px 6px;background:transparent;border-radius:6px;border:1px solid rgba(255,255,255,0.03);font-size:13px;cursor:pointer;color:var(--muted);transition:all 0.2s}
  .scale label:hover{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.08)}
  .scale input[type=radio]:checked + label{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#072034;border:1px solid rgba(255,255,255,0.06);font-weight:600;transform:scale(1.05)}
  .actions{display:flex;gap:8px;margin-top:12px}
  button{cursor:pointer;padding:10px 12px;border-radius:8px;border:none;background:var(--accent);color:#042034;font-weight:700;transition:all 0.2s}
  button:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(125,211,252,0.3)}
  button:disabled{opacity:0.5;cursor:not-allowed;transform:none}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
  button.ghost:hover{background:rgba(255,255,255,0.02)}
  .result{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
  .bar{height:12px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden;margin:6px 0}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#60a5fa);width:0%;transition:width 0.5s ease}
  .archetypes{margin-top:10px}
  .atype{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;animation:fadeIn 0.3s}
  @keyframes fadeIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}
  .small{font-size:13px;color:var(--muted)}
  .radar{width:100%;height:260px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:8px;display:flex;align-items:center;justify-content:center}
  .footer{margin-top:10px;color:var(--muted);font-size:13px;text-align:center}
  .status-badge{display:inline-block;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600;margin-left:8px}
  .status-incomplete{background:rgba(239,68,68,0.1);color:#ef4444}
  .status-complete{background:rgba(34,197,94,0.1);color:#22c55e}
  @media(max-width:980px){.grid{grid-template-columns:1fr;}.panel{position:sticky;top:12px}}
</style>
</head>
<body>
<div class="wrap">
  <h1>SCEMVAB PPI — 전체 검사 (120문항)</h1>
  <p class="lead">7차원 성격 프로파일을 정교하게 측정합니다. 각 문항은 1(전혀 아니다)부터 7(매우 그렇다)까지 응답해주세요.</p>
  
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  
  <div class="grid">
    <div class="questions panel" id="questions">
      <!-- Questions injected by JS -->
    </div>

    <div class="panel" id="side">
      <div class="result" id="summary">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">검사 진행 중</div>
            <div class="small">응답률: <span id="answerRate">0%</span></div>
          </div>
          <div style="text-align:right">
            <div class="small">응답/총</div>
            <div style="font-weight:800;font-size:20px"><span id="answered">0</span>/<span id="totalN">120</span></div>
          </div>
        </div>
        
        <div style="margin-top:10px">
          <div class="small">측정 차원 (0–100)</div>
          <div id="bars"></div>
        </div>

        <div class="archetypes" id="archetypes">
          <div class="small">대표 유형</div>
        </div>

        <div style="margin-top:10px" class="small">프로파일 레이더</div>
        <div class="radar" id="radar">
          <svg id="rad" width="260" height="260" viewBox="-130 -130 260 260"></svg>
        </div>

        <div class="actions">
          <button id="show">결과 보기</button>
          <button class="ghost" id="reset">다시하기</button>
          <button class="ghost" id="export">결과 저장</button>
        </div>
      </div>

      <div class="footer">© 2025 Synox Studios. All rights reserved.</div>
    </div>
  </div>
</div>

<script>
const axes = ["E","C","S","M","V","A","B"];
const axisNames = {
  E: "감정성 (Emotionality)",
  C: "인지력 (Cognition)",
  S: "사회성 (Sociability)",
  M: "관리력 (Management)",
  V: "동기력 (Volition)",
  A: "적응력 (Adaptability)",
  B: "자율성 (Balance)"
};

const axisCounts = [18,17,17,17,17,17,17];

const basePrompts = {
  E: [
    "사소한 일에도 감정이 쉽게 흔들린다.",
    "감정이 얼굴에 잘 드러나는 편이다.",
    "누군가에게 상처받으면 오래 잊지 못한다.",
    "기분이 자주 오르락내리락한다.",
    "힘든 일이 있어도 감정을 잘 다스린다.",
    "다른 사람의 말에 쉽게 기분이 상한다.",
    "감정이 폭발하면 후회하는 경우가 많다.",
    "감정 표현을 억제하는 편이다.",
    "작은 일에도 기분이 좋아지거나 나빠진다.",
    "스트레스를 받으면 감정이 불안정해진다.",
    "다른 사람의 감정 변화에 쉽게 공감한다.",
    "내 감정을 객관적으로 바라보는 편이다.",
    "예상치 못한 일에 놀라거나 당황하기 쉽다.",
    "감정을 표현하지 않고 속으로 삭인다.",
    "감정이 내 판단에 영향을 주는 경우가 많다.",
    "기분 변화가 심해도 금방 회복된다.",
    "감정적인 순간이 많지만 후회는 적다.",
    "감정에 솔직한 편이다."
  ],
  C: [
    "문제를 체계적으로 분석하려 한다.",
    "논리보다는 감으로 판단한다.",
    "자료를 찾아 근거를 확인하는 편이다.",
    "새로운 개념을 이해하는 데 흥미를 느낀다.",
    "직관적으로 결정을 내리는 편이다.",
    "복잡한 문제일수록 더 끈기 있게 접근한다.",
    "여러 가능성을 계산해 행동한다.",
    "즉흥적으로 결론을 내리곤 한다.",
    "생각을 정리하는 것을 즐긴다.",
    "논리보다는 사람의 감정을 우선시한다.",
    "아이디어를 구조적으로 발전시킨다.",
    "비합리적인 판단을 피하려 노력한다.",
    "창의적인 아이디어보다 검증된 방법을 선호한다.",
    "복잡한 개념도 빠르게 이해한다.",
    "감정보다는 사실을 중시한다.",
    "분석보다 직관이 더 믿을 만하다고 느낀다.",
    "생각을 정리하기 위해 기록을 자주 한다."
  ],
  S: [
    "낯선 사람과 쉽게 대화할 수 있다.",
    "혼자 있는 게 가장 편하다.",
    "사람들과 어울릴 때 에너지가 생긴다.",
    "감정적으로 공감하는 편이다.",
    "대화보다는 혼자 생각하는 걸 선호한다.",
    "갈등을 피하려 노력한다.",
    "다른 사람을 도와줄 때 보람을 느낀다.",
    "타인의 평가에 크게 신경 쓰지 않는다.",
    "모임에서 분위기를 주도하는 편이다.",
    "상대방의 감정에 둔감하다는 말을 들은 적 있다.",
    "친구의 고민을 잘 들어주는 편이다.",
    "혼자 있는 시간이 꼭 필요하다.",
    "다른 사람의 기분 변화를 잘 감지한다.",
    "낯선 환경에서 쉽게 적응하지 못한다.",
    "주변 사람과 함께할 때 안정감을 느낀다.",
    "인간관계가 내 삶에서 중요한 부분을 차지한다.",
    "사람들과 함께 있을 때 불편함을 느낀다."
  ],
  M: [
    "해야 할 일을 미루지 않는다.",
    "계획을 세우고 그대로 실행한다.",
    "마감일이 다가와야 일을 시작한다.",
    "해야 할 일 목록을 자주 만든다.",
    "즉흥적으로 움직이는 편이다.",
    "하루를 계획적으로 보내려 노력한다.",
    "일이 완벽해야 마음이 편하다.",
    "계획보다는 그때그때 상황에 맞춰 움직인다.",
    "실수를 반복하지 않으려 노력한다.",
    "일의 우선순위를 잘 정한다.",
    "정해진 규칙을 지키는 것을 중요하게 생각한다.",
    "작은 일이라도 끝까지 완수하려 한다.",
    "체계적인 방법으로 문제를 해결한다.",
    "충동적으로 결정하는 편이다.",
    "해야 할 일을 미루면 불안하다.",
    "규칙적인 생활을 유지하려 노력한다.",
    "주어진 일을 끝내지 않고 넘어가는 경우가 많다."
  ],
  V: [
    "나만의 목표가 분명하다.",
    "꿈보다는 현실적인 선택을 중시한다.",
    "목표를 위해 노력하는 것을 즐긴다.",
    "무언가에 몰두할 때 시간이 빨리 간다.",
    "특별한 이유 없이 노력하기 어렵다.",
    "성공에 대한 열망이 크다.",
    "하고 싶은 일을 위해 희생할 수 있다.",
    "현재의 편안함이 가장 중요하다.",
    "목표를 이루면 다음 목표를 세운다.",
    "일시적인 유혹에 쉽게 흔들린다.",
    "내가 원하는 것이 무엇인지 잘 안다.",
    "남들이 정한 길보다 내 길을 가고 싶다.",
    "결과보다는 과정에 집중한다.",
    "도전적인 일을 좋아한다.",
    "실패를 두려워하지 않는다.",
    "계획이 틀어지면 쉽게 의욕을 잃는다.",
    "목표를 향해 꾸준히 나아간다."
  ],
  A: [
    "새로운 아이디어를 떠올리는 게 즐겁다.",
    "남들이 생각하지 못한 방법을 자주 떠올린다.",
    "정해진 틀 안에서 일하는 게 편하다.",
    "색다른 시도를 좋아한다.",
    "변화보다는 안정이 좋다.",
    "창의적인 활동을 좋아한다.",
    "문제를 해결하는 새로운 방식을 찾는다.",
    "새로운 환경에 잘 적응한다.",
    "남들과 다른 시각으로 세상을 본다.",
    "규칙이 많은 환경은 답답하다.",
    "상상하는 걸 즐긴다.",
    "일상적인 일은 금방 질린다.",
    "새로운 것을 배우는 게 재미있다.",
    "변화를 두려워하지 않는다.",
    "남들이 하지 않는 일을 해보고 싶다.",
    "새로운 방법을 시도하는 걸 주저하지 않는다.",
    "반복되는 일에는 흥미를 잃는다."
  ],
  B: [
    "자신의 생각을 솔직하게 표현한다.",
    "다른 사람의 의견에 쉽게 휘둘린다.",
    "자신의 주장을 분명히 말한다.",
    "비판을 받으면 위축된다.",
    "상황이 불공평하면 바로 지적한다.",
    "다른 사람에게 쉽게 의존한다.",
    "리더 역할을 맡는 것을 좋아한다.",
    "결정을 내릴 때 주저한다.",
    "자신의 선택에 책임을 진다.",
    "타인의 눈치를 많이 본다.",
    "하고 싶은 말을 망설이지 않는다.",
    "다른 사람의 부탁을 거절하지 못한다.",
    "스스로 문제를 해결하려 한다.",
    "남의 의견에 반대하는 게 어렵다.",
    "필요하면 단호하게 행동한다.",
    "타인의 시선을 크게 신경 쓰지 않는다.",
    "리더십을 발휘하는 걸 즐긴다."
  ]
};

const items = [];
for(let ax=0; ax<7; ax++){
  const key = axes[ax];
  const count = axisCounts[ax];
  const templates = basePrompts[key];
  for(let i=0;i<count;i++){
    const base = templates[i % templates.length];
    items.push({ t: base, a: ax });
  }
}

const archetypes = [
  {id:"Orion", desc:"분석가형", v:[25,88,30,72,50,68,28]},
  {id:"Vesta", desc:"창조적 열정가", v:[85,88,80,82,90,88,82]},
  {id:"Nereid", desc:"감정 공감가", v:[82,60,90,50,72,60,64]},
  {id:"Atlas", desc:"안정적 관리자", v:[18,82,80,78,30,22,20]},
  {id:"Hermes", desc:"탐험가", v:[50,75,70,76,80,88,72]},
  {id:"Selene", desc:"사색가", v:[78,84,30,48,72,56,75]},
  {id:"Ares", desc:"결단가", v:[20,85,20,92,28,52,36]},
  {id:"Gaia", desc:"조화형 조정자", v:[50,60,86,60,58,78,58]},
  {id:"Helios", desc:"혁신 리더", v:[88,90,82,88,92,90,86]},
  {id:"Nyx", desc:"신비적 내면형", v:[82,78,22,40,86,30,80]}
];

const qpanel = document.getElementById('questions');
items.forEach((it, idx) => {
  const el = document.createElement('div');
  el.className='q';
  el.dataset.idx = idx;
  let radios = '';
  for(let n=1;n<=7;n++){
    radios += `<input type="radio" id="q${idx}_r${n}" name="q${idx}" value="${n}"><label for="q${idx}_r${n}">${n}</label>`;
  }
  el.innerHTML = `<div class="txt"><strong>Q${idx+1}.</strong> ${it.t}</div>
    <div class="scale">${radios}</div>`;
  qpanel.appendChild(el);
});

const bars = document.getElementById('bars');
axes.forEach(ax => {
  const wrap = document.createElement('div');
  wrap.innerHTML = `<div style="display:flex;justify-content:space-between"><div style="font-weight:700">${ax} <span class="small">${axisNames[ax]}</span></div><div class="small" id="lbl_${ax}">-</div></div>
  <div class="bar"><i id="bar_${ax}"></i></div>`;
  bars.appendChild(wrap);
});

function updateProgress(){
  const answers = readAnswers();
  const count = answers.filter(v => v !== null).length;
  const pct = Math.round(count/items.length*100);
  document.getElementById('progressFill').style.width = pct+'%';
  document.getElementById('answered').textContent = count;
  document.getElementById('answerRate').textContent = pct+'%';
  
  document.querySelectorAll('.q').forEach((el, i) => {
    if(answers[i] !== null) {
      el.classList.add('answered');
    } else {
      el.classList.remove('answered');
    }
  });
}

qpanel.addEventListener('change', updateProgress);

function readAnswers(){
  const answers = [];
  for(let i=0;i<items.length;i++){
    const radios = document.getElementsByName('q'+i);
    let val = null;
    for(const r of radios){ if(r.checked){ val = Number(r.value); break; } }
    answers.push(val);
  }
  return answers;
}

function computeProfile(answers){
  const mapVal = v => (v===null ? null : Math.round((v-1)/6*100));
  const sums = new Array(7).fill(0);
  const counts = new Array(7).fill(0);
  answers.forEach((ans, i) => {
    const ax = items[i].a;
    const v = mapVal(ans);
    if(v!==null){ sums[ax]+=v; counts[ax]++; }
  });
  const profile = sums.map((s, i) => counts[i]?Math.round(s/counts[i]):50);
  return profile;
}

function showProfile(profile){
  axes.forEach((ax,i)=>{
    document.getElementById('lbl_'+ax).textContent = profile[i] + " /100";
    document.getElementById('bar_'+ax).style.width = profile[i]+'%';
  });
  
  const dists = archetypes.map(a => {
    let s=0;
    for(let i=0;i<7;i++){ const diff = profile[i]-a.v[i]; s += diff*diff; }
    return Math.sqrt(s);
  });
  const maxd = Math.max(...dists);
  const simRaw = dists.map(d => Math.max(0, (maxd - d)));
  const sumSim = simRaw.reduce((a,b)=>a+b,0) || 1;
  const sims = simRaw.map(s => Math.round(s/sumSim*100));
  
  let total = sims.reduce((a,b)=>a+b,0);
  if(total !== 100){
    const diff = 100 - total;
    sims[0] += diff;
  }

  const archDiv = document.getElementById('archetypes');
  archDiv.innerHTML = '<div class="small">대표 유형</div>';
  const paired = archetypes.map((a,i)=>({id:a.id,desc:a.desc,score:sims[i],d:dists[i]}))
    .sort((x,y)=>y.score - x.score);
  paired.slice(0,3).forEach(p=>{
    const el = document.createElement('div');
    el.className='atype';
    el.innerHTML = `<div><strong>${p.id}</strong><div class="small">${p.desc}</div></div><div style="text-align:right"><div style="font-weight:800">${p.score}%</div></div>`;
    archDiv.appendChild(el);
  });

  drawRadar(profile);
}

function drawRadar(profile){
  const svg = document.getElementById('rad');
  svg.innerHTML = '';
  const R = 100;
  const N = axes.length;
  
  for(let ring=4; ring>=1; ring--){
    const rr = R*ring/4;
    const points = [];
    for(let i=0;i<N;i++){
      const ang = -Math.PI/2 + i*(2*Math.PI/N);
      const x = rr*Math.cos(ang);
      const y = rr*Math.sin(ang);
      points.push(`${x},${y}`);
    }
    const poly = document.createElementNS("http://www.w3.org/2000/svg","polygon");
    poly.setAttribute("points",points.join(' '));
    poly.setAttribute("fill","none");
    poly.setAttribute("stroke","rgba(255,255,255,0.06)");
    poly.setAttribute("stroke-width","1");
    svg.appendChild(poly);
  }
  
  for(let i=0;i<N;i++){
    const ang = -Math.PI/2 + i*(2*Math.PI/N);
    const x = (R+16)*Math.cos(ang);
    const y = (R+16)*Math.sin(ang);
    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x",x);
    t.setAttribute("y",y+4);
    t.setAttribute("text-anchor","middle");
    t.setAttribute("font-size","11");
    t.setAttribute("fill","rgba(255,255,255,0.8)");
    t.textContent = axes[i];
    svg.appendChild(t);
    const lx = R*Math.cos(ang);
    const ly = R*Math.sin(ang);
    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("x1","0");
    line.setAttribute("y1","0");
    line.setAttribute("x2",lx);
    line.setAttribute("y2",ly);
    line.setAttribute("stroke","rgba(255,255,255,0.03)");
    svg.appendChild(line);
  }
  
  const pts = [];
  for(let i=0;i<N;i++){
    const v = profile[i]/100;
    const r = v*R;
    const ang = -Math.PI/2 + i*(2*Math.PI/N);
    const x = r*Math.cos(ang);
    const y = r*Math.sin(ang);
    pts.push(`${x},${y}`);
  }
  const poly = document.createElementNS("http://www.w3.org/2000/svg","polygon");
  poly.setAttribute("points",pts.join(' '));
  const defs = document.createElementNS("http://www.w3.org/2000/svg","defs");
  defs.innerHTML = `<linearGradient id="ggrad" x1="0" x2="1"><stop offset="0%" stop-color="#7dd3fc" stop-opacity="0.24"/><stop offset="100%" stop-color="#60a5fa" stop-opacity="0.12"/></linearGradient>`;
  svg.appendChild(defs);
  poly.setAttribute("fill","url(#ggrad)");
  poly.setAttribute("stroke","rgba(125,211,252,0.9)");
  poly.setAttribute("stroke-width","2");
  svg.appendChild(poly);
}

document.getElementById('show').addEventListener('click',()=>{
  const answers = readAnswers();
  const missing = answers.reduce((acc,v)=>acc + (v===null?1:0),0);
  if(missing>0){
    if(!confirm(`미응답 ${missing}문항이 있습니다. 미응답은 자동으로 중립값(4)으로 처리됩니다. 계속하시겠습니까?`)){
      return;
    }
  }
  const filled = answers.map(v => v===null?4:v);
  const profile = computeProfile(filled);
  showProfile(profile);
  document.getElementById('side').scrollIntoView({behavior:'smooth'});
});

document.getElementById('reset').addEventListener('click',()=>{
  if(!confirm('테스트를 초기화하고 처음부터 시작하시겠습니까?')) return;
  for(let i=0;i<items.length;i++){
    const radios = document.getElementsByName('q'+i);
    for(const r of radios) r.checked = false;
  }
  axes.forEach(ax=>{
    document.getElementById('lbl_'+ax).textContent='-';
    document.getElementById('bar_'+ax).style.width='0%';
  });
  document.getElementById('archetypes').innerHTML = '<div class="small">대표 유형</div>';
  document.getElementById('rad').innerHTML='';
  updateProgress();
});

document.getElementById('export').addEventListener('click',()=>{
  const answers = readAnswers();
  const missing = answers.reduce((acc,v)=>acc + (v===null?1:0),0);
  if(missing > 50){
    alert('검사를 충분히 완료한 후 결과를 저장할 수 있습니다.');
    return;
  }
  const filled = answers.map(v => v===null?4:v);
  const profile = computeProfile(filled);
  
  const result = {
    date: new Date().toISOString(),
    answers: filled,
    profile: profile.map((v,i) => ({axis: axes[i], name: axisNames[axes[i]], score: v})),
    archetypes: archetypes.map((a,i) => {
      const dists = archetypes.map(arch => {
        let s=0;
        for(let j=0;j<7;j++){ const diff = profile[j]-arch.v[j]; s += diff*diff; }
        return Math.sqrt(s);
      });
      const maxd = Math.max(...dists);
      const simRaw = dists.map(d => Math.max(0, (maxd - d)));
      const sumSim = simRaw.reduce((a,b)=>a+b,0) || 1;
      const sims = simRaw.map(s => Math.round(s/sumSim*100));
      return {id: a.id, desc: a.desc, similarity: sims[i]};
    }).sort((x,y) => y.similarity - x.similarity).slice(0,5)
  };
  
  const blob = new Blob([JSON.stringify(result, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `SCEMVAB_결과_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
});

updateProgress();